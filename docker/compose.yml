# OpenTL Server
#
# Usage (from the project root):
#   docker compose -f docker/compose.yml --env-file .env up -d
#
# Or simply:
#   make docker-up
#
# This starts the OpenTL server. Sandbox containers are created
# dynamically by the server when sessions are started.

services:
  server:
    build:
      context: ..
      dockerfile: docker/server.Dockerfile
    ports:
      - "7080:7080"
    volumes:
      - opentl-data:/data
      - /var/run/docker.sock:/var/run/docker.sock
    env_file:
      - path: ../.env
        required: false
      - path: ${HOME}/.opentl/config.env
        required: false
    environment:
      - OPENTL_ADDR=:7080
      - OPENTL_DATA_DIR=/data
      - OPENTL_DOCKER_IMAGE=opentl-sandbox
      - OPENTL_DOCKER_NETWORK=opentl-net
    networks:
      - opentl-net
    restart: unless-stopped

networks:
  opentl-net:
    name: opentl-net

volumes:
  opentl-data:
